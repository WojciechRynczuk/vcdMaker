<?xml version='1.0' encoding='Windows-1252'?>
<?include version.wxi ?>
<?define UpgradeCode="3A563016-E31D-4D93-A36B-105420BA6E57"?>

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
  <Product Name='vcdMaker $(var.ProductVersionInfo)' Id='3A142969-4CD6-48F2-AB64-D44F690E7193' UpgradeCode='$(var.UpgradeCode)'
    Language='1033' Codepage='1252' Version='$(var.ProductVersion)' Manufacturer='vcdMaker team'>

    <Package Id='*' Keywords='vcdMaker Installer'
      Description="vcdMaker $(var.ProductVersionInfo) Installer"
      Comments='vcdMaker Package' Manufacturer='vcdMaker team'
      InstallerVersion='200' Languages='1033' Compressed='yes' SummaryCodepage='1252' 
      InstallScope='perUser'/>
    
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed. Setup will now exit." />
	
    <Upgrade Id='$(var.UpgradeCode)'>
    <UpgradeVersion OnlyDetect='no' Property='PREVIOUSFOUND'
        Minimum='1.0.0' IncludeMinimum='yes'
        Maximum='3.0.1' IncludeMaximum='no' />
    </Upgrade>

    <Media Id='1' Cabinet='Install.cab' EmbedCab='yes' DiskPrompt="CD-ROM #1" />
    <Property Id='DiskPrompt' Value="vcdMaker $(var.ProductVersionInfo) Installation [1]" />
    <Property Id="DISABLEADVTSHORTCUTS" Value="1" />

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='ProgramFilesFolder' Name='PFiles'>
        <Directory Id='INSTALLDIR' Name='vcdMaker'>

          <Component Id='vcdMakerExecutable' Guid='15247FDC-7EA8-4931-B96A-DD3B3926B74E'>
            <Environment Id='UpdatePath' Name='PATH' Action='set' Permanent='no' System='no' Part='last' Value='[INSTALLDIR]' />
            <File Id='vcdMakerEXE' Name='$(var.vcdMaker.TargetFileName)' DiskId='1' Source='$(var.vcdMaker.TargetPath)' KeyPath='yes'>
            </File>
          </Component>

          <Component Id='vcdMergeExecutable' Guid='2E82E953-9A3F-4AC0-A4C0-9F352C0ACDF1'>
            <File Id='vcdMergeEXE' Name='$(var.vcdMerge.TargetFileName)' DiskId='1' Source='$(var.vcdMerge.TargetPath)' KeyPath='yes'>
            </File>
          </Component>

          <Component Id='vcdMakerManual' Guid='11B39AA4-49B4-4D18-AE33-3D278BC8BE84'>
            <File Id="ManualPdf" Name="Manual.pdf" Source="$(var.SolutionDir)..\..\sources\common\doc\manual.pdf" KeyPath='yes'>
              <Shortcut Id="vcdMakerManualLnk" Directory="ProgramMenuDir" Name="vcdMaker $(var.ProductVersionInfo) Manual" WorkingDirectory='INSTALLDIR' IconIndex="0" Advertise="yes" />
            </File>
          </Component>
          
          <Directory Id='SampleDir' Name='samples'>
            <Component Id='SampleFiles' Guid='59F4E01F-5FE3-48B3-97A2-8E7808E6EED7'>
              <File Id="SampleTtx" Name="example.txt" Source="$(var.SolutionDir)..\..\sources\common\doc\examples\example.txt" KeyPath='yes'></File>
              <File Id="SampleVcd" Name="example.vcd" Source="$(var.SolutionDir)..\..\sources\common\doc\examples\example.vcd"></File>
              <File Id="System1Time1Txt" Name="system1_time1.txt" Source="$(var.SolutionDir)..\..\sources\common\doc\examples\system1_time1.txt"></File>
              <File Id="System2Time1Txt" Name="system2_time1.txt" Source="$(var.SolutionDir)..\..\sources\common\doc\examples\system2_time1.txt"></File>
              <File Id="System2Time2Txt" Name="system2_time2.txt" Source="$(var.SolutionDir)..\..\sources\common\doc\examples\system2_time2.txt"></File>
              <File Id="MergeT1T2Vcd" Name="merge_t1_t1.vcd" Source="$(var.SolutionDir)..\..\sources\common\doc\examples\merge_t1_t1.vcd"></File>
              <File Id="MergeT1T1Vcd" Name="merge_t1_t2.vcd" Source="$(var.SolutionDir)..\..\sources\common\doc\examples\merge_t1_t2.vcd"></File>
            </Component>
          </Directory>
        
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuDir" Name="vcdMaker $(var.ProductVersionInfo)">
          <Component Id="ProgramMenuDir" Guid="59CBFDEC-3666-4313-9DF6-D6B97768FFD5">
            <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
            <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
          </Component>
        </Directory>
      </Directory>

    <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <Feature Id='MainProgram' Title='vcdMaker $(var.ProductVersionInfo)' Description='The vcdMaker package.' Level='1'>
      <ComponentRef Id='vcdMakerExecutable' />
      <ComponentRef Id='vcdMergeExecutable' />
      <ComponentRef Id='vcdMakerManual' />
      <ComponentRef Id='SampleFiles' />
      <ComponentRef Id='ProgramMenuDir' />
    </Feature>

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <UIRef Id="WixUI_InstallDir" />
    
    <WixVariable Id="WixUILicenseRtf" Value="$(var.ProjectDir)\resources\license.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="$(var.ProjectDir)\resources\vM-bannrbmp.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="$(var.ProjectDir)\resources\vM-dlgbmp.bmp" />
    
    <Icon Id="icon.ico" SourceFile="$(var.ProjectDir)\resources\vcdMaker128.ico"/>
    <Property Id="ARPPRODUCTICON" Value="icon.ico" />

  </Product>
</Wix>
